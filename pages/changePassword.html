<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		<!DOCTYPE html>
		<html>
			<head>
				<meta charset="utf-8">
				<title></title>

				<link rel="stylesheet" href="../bootstrap-3.3.7-dist/css/bootstrap.css">
				<link rel="stylesheet" type="text/css" href="../css/mycss.css" />
				<link rel="stylesheet" type="text/css" href="../css/bootstrapValidator.min.css" />
				<script src="../js/jquery-3.3.1.js" type="text/javascript" charset="utf-8"></script>
				<script src="../bootstrap-3.3.7-dist/js/bootstrap.js" type="text/javascript" charset="utf-8"></script>
				<script src="../js/bootstrapValidator.min.js" type="text/javascript" charset="utf-8"></script>
			</head>
			<body>


				<nav class="navbar navbar-default navbar-fixed-top gradient">
					<div class="container">
						<div class="navbar-header">
							<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"
							 aria-expanded="false">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>
							<a class="navbar-brand" href="../index.html">志愿服务</a>
						</div>
						<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

							<form class="navbar-form navbar-left">
								<div class="form-group">
									<input type="text" class="form-control" placeholder="搜索&hellip;">
								</div>
								<button type="submit" class="btn btn-default">搜索</button>
							</form>
							<ul class="nav navbar-nav">
								<li><a id="create-projs" class="hidden-xs" href="../pages/create-projs.html">发布项目</a></li>
							</ul>
							<ul class="nav navbar-nav navbar-right">
								<li><a class="navbar-registe hidden-xs" style="padding-right:0; padding-left: 0;" href="../pages/registe.html">注册</a></li>
								<li><a class="xiegang hidden-xs" style="padding-right:0; padding-left: 0;" href="../pages/registe.html">/</a></li>
								<li><a class="navbar-login hidden-xs" style="padding-right:0; padding-left: 0;" href="../pages/login.html">登陆</a></li>
								<li>
									<div class="navbar-touxiang"><img src="#" class="touxiang proj-touxiang navbar-left img-circle img-responsive text-center"></div>
								</li>
								<li><a class="hidden-lg hidden-md hidden-sm" href="../pages/create-projs.html">发布项目</a></li>
								<li><a class="hidden-lg hidden-md hidden-sm" href="../pages/registe.html">注册</a></li>
								<li><a class="hidden-lg hidden-md hidden-sm" href="../pages/login.html">登陆</a></li>
								<li><a href="../pages/person-center.html" class="hidden-lg hidden-md hidden-sm">个人中心</a></li>
							</ul>
						</div>
					</div>
				</nav>


				<div class="login-div">
					<div class="login-inner-div">
						<form action="">
							<form class="form-horizontal">
								<div class="form-group changePassword-form-group1 col-sm-12">
									<div class="col-sm-3">&nbsp;</div>
									<label for="inputEmail3" class="col-sm-2 control-label">手机号</label>
									<div class="col-sm-4">
										<input type="text" class="form-control" id="inputUsername" placeholder="请输入11位手机号" name="username">
									</div>
									<div class="col-sm-3">&nbsp;</div>
								</div>
								<div class="form-group changePassword-form-group2 col-sm-12">
									<div class="col-sm-3">&nbsp;</div>
									<label for="inputPassword3" class="col-sm-2 control-label">密码</label>
									<div class="col-sm-4">
										<input type="password" class="form-control" id="inputPassword" placeholder="请输入6-16位密码" name="password">
									</div>
									<div class="col-sm-3">&nbsp;</div>
								</div>
								<!-- <div class="form-group changePassword-form-group3 col-sm-12">
									<div class="col-sm-3">&nbsp;</div>
									<label for="inputPassword4" class="col-sm-2 control-label">确认密码</label>
									<div class="col-sm-4">
										<input type="password" class="form-control" id="inputPassword1" placeholder="请再次输入密码" name="ensurePassword">
									</div>
									<div class="col-sm-3">&nbsp;</div>
								</div> -->
								<div class="form-group changePassword-form-group3 col-sm-12">
									<div class="col-sm-3">&nbsp;</div>
									<label for="inputPassword4" class="col-sm-2 control-label">验证码</label>
									<div class="col-sm-4">
										<input type="text" class="form-control" id="inputCode" placeholder="请输入6位验证码" name="code">
									</div>
									<label for="inputPassword4" class="col-sm-3 control-label" id="checkcode">获取验证码</label>
								</div>
								<div class="form-group changePassword-form-group5 col-sm-12">
									<div class="col-sm-5">&nbsp;</div>
									<div class="">
										<div class=""><button type="" class="btn btn-default changePassword-btn">修改密码</button></div>
									</div>
								</div>
							</form>
						</form>
					</div>
				</div>


				<nav class="navbar navbar-default navbar-fixed-bottom">
					<div class="container">
						<address>Copyright&nbsp;©&nbsp;2019&nbsp;ZhiYuanFuWu&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved</address>
						<address>桂林电子科技大学·志愿服务团队</address>
					</div>
				</nav>
			</body>
			<script type="text/javascript">
				$("#checkcode").click(function() {
					// 					var json = {
					// 						"username": $("#inputUsername").val(),
					// 					};
					// 					var jsondata;
					// 					jsondata = JSON.stringify(json);
					// 					console.log(jsondata);
					var urlstr = 'http://139.199.86.115:8080/ProjectForDaChuang/getPhoneNumber?username=';
					urlstr += $("#inputUsername").val();
					alert(urlstr);
					$.ajax({
						async: true,
						type: "GET",
						url: urlstr,
						// data: jsondata,
						dataType: "json",
						// contentType : 'application/json;charset=UTF-8',
						success: function(result) {
							console.log(result);
							if (result.code == 200) {
								alert(result.data.content);
							} else {
								alert(result.data.content);
							}
						}
					})
				})
				$(".changePassword-btn").click(function() {
					var json = {
						"username": $("#inputUsername").val(),
						"password": $("#inputPassword").val(),
						"code": parseInt($("#inputCode").val())
					};
					var jsondata;
					jsondata = JSON.stringify(json);
					console.log(json);
					$.ajax({
						async: true,
						type: "POST",
						url: 'http://139.199.86.115:8080/ProjectForDaChuang/resetPassword',
						data: jsondata,
						dataType: "json",
						contentType: 'application/json;charset=UTF-8',
						success: function(result) {
							console.log(result);
							if (result.code == 200) {
								alert(result.data.content);
							} else {
								alert(result.data.content);
							}
						}
					})
				})


				if(sessionStorage.login=="true"){
					var json = {
						"username": sessionStorage.username,
						"token": sessionStorage.token
					}
					var jsondata;
					jsondata = JSON.stringify(json);
					console.log(json);
					$.ajax({
						async: true,
						type: 'post',
						url: 'http://139.199.86.115:8080/ProjectForDaChuang/getUserInfoByMobile',
						data: jsondata,
						dataType: "json",
						contentType: 'application/json;charset=UTF-8',
						success: function(result) {
							console.log(result);
							if (result.code == 200) {
								sessionStorage.token = result.data.content.token;
								// alert(result.data.content.userNick);
								$(".username-label").text(result.data.content.userNick);
								$(".sex-label").text(result.data.content.userSex);
								$(".job-label").text(result.data.content.userIdentify);
								$(".address-label").text(result.data.content.userAddress);
								$(".phone-label").text(result.data.content.userPhone);
								$(".person-center-touxiang").attr("src", result.data.content.userHeadPictureLink);
								$(".touxiang").attr("src", result.data.content.userHeadPictureLink);
							} else {
								alert("no");
							}
						}
					})
					
				}
				$(".login-div").height($(window).height() / 2);
				$(".login-inner-div").height($(window).height() / 3);
				$('form').bootstrapValidator({
					message: 'This value is not valid',
					feedbackIcons: {
						valid: 'glyphicon glyphicon-ok',
						invalid: 'glyphicon glyphicon-remove',
						validating: 'glyphicon glyphicon-refresh'
					},
					fields: {
						username: {
							message: '用户名验证失败',
							validators: {
								notEmpty: {
									message: '用户名不能为空'
								},
								stringLength: {
									min: 11,
									max: 11,
									message: '用户名长度必须为11位手机号'
								},
								regexp: {
									regexp: /^[a-zA-Z0-9_]+$/,
									message: '用户名只能包含大写、小写、数字和下划线'
								}
							}
						},
						password: {
							message: '密码错误',
							validators: {
								notEmpty: {
									message: '密码不能为空'
								},
								stringLength: {
									min: 6,
									max: 16,
									message: '密码长度必须在6到16位之间'
								},
								regexp: {
									regexp: /^[a-zA-Z0-9_]+$/,
									message: '密码只能包含大写、小写、数字和下划线'
								}
							}
						},
						ensurePassword: {
							message: '密码错误',
							validators: {
								notEmpty: {
									message: '密码不能为空'
								},
								stringLength: {
									min: 6,
									max: 16,
									message: '密码长度必须在6到16位之间'
								},
								regexp: {
									regexp: /^[a-zA-Z0-9_]+$/,
									message: '密码只能包含大写、小写、数字和下划线'
								}
							}
						},
						code: {
							message: '验证码错误',
							validators: {
								notEmpty: {
									message: '验证码不能为空'
								},
								stringLength: {
									min: 6,
									max: 6,
									message: '验证码为6位数字'
								},
								regexp: {
									regexp: /^[0-9]+$/,
									message: '验证码只能是数字'
								}
							}
						}

					}
				});
			</script>
		</html>
